<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
<meta property="og:title" content="Conex√£o Shop">
<meta property="og:description" content="Acessorios para caminh√£o , produtos para est√©tica , camisas de agrupamentos">
<meta property="og:image" content="https://conexaoshop.vercel.app/public/4.png">
<meta property="og:url" content="https://conexaoshop.vercel.app/">
<meta property="og:type" content="website">

<!-- Para WhatsApp exibir imagem maior -->
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:image" content="https://conexaoshop.vercel.app/public/4.png">
<title>Loja ‚Äî Conex√£o Shop</title>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600&display=swap" rel="stylesheet">
<style>
:root{
  --bg:#8a8ac2; --card:#565555; --accent:#ffcc00; --muted:#bfbfbf; --white:#8e7a0b;
}
*{box-sizing:border-box}
body{
  margin:0; font-family:"Poppins",sans-serif; background:linear-gradient(180deg,#e5e5e6,#ffffff);
  color:var(--white);
}
header{
  padding:18px 24px; display:flex; align-items:center; justify-content:space-between;
  background:linear-gradient(90deg,#2e2e30,#474646); border-bottom:1px solid rgba(109, 106, 106, 0.03);
}
.brand{display:flex; align-items:center; gap:12px}
.brand .logo{width:46px;height:46px;border-radius:8px;background:linear-gradient(135deg,#a5a3a3,#111);display:flex;align-items:center;justify-content:center;font-weight:700;color:var(--accent)}
.search{flex:1; margin:0 20px}
.search input{width:100%; padding:10px 14px; border-radius:8px; border:1px solid rgba(255,255,255,0.06); background:#0b0b0b; color:var(--white)}

/* Grid produtos */
.container{max-width:1200px;margin:28px auto;padding:0 18px}
.filters{display:flex;gap:12px;flex-wrap:wrap;margin-bottom:18px}
.filters select, .filters button{padding:8px 10px;border-radius:8px;border:1px solid rgba(255,255,255,0.06);background:#0b0b0b;color:var(--white)}
.grid{display:grid;grid-template-columns:repeat(4,1fr);gap:18px}
@media(max-width:1000px){.grid{grid-template-columns:repeat(3,1fr)}}
@media(max-width:700px){
  .grid { grid-template-columns: repeat(2,1fr); }
  .search { display: block; width: 100%; margin: 10px 0; }
  .search input { font-size: 14px; padding: 8px; }
}
@media(max-width:420px){.grid{grid-template-columns:1fr}}

.card{background:var(--card);border-radius:12px;padding:12px;display:flex;flex-direction:column;gap:10px;box-shadow:0 6px 18px rgba(0,0,0,0.6)}
.thumb{height:160px;border-radius:8px;background:#0a0a0a;display:flex;align-items:center;justify-content:center;overflow:hidden}
.thumb img{width:100%;height:100%;object-fit:cover}
.title{font-weight:600;font-size:1rem;color: #000 !important; }
.price{font-weight:700;color:var(--accent)}
.actions{display:flex;gap:8px;margin-top:auto}
.btn{flex:1;padding:8px 10px;border-radius:8px;border:none;cursor:pointer;font-weight:600}
.btn.info{background:transparent;border:1px solid rgba(219, 19, 19, 0.06);color:var(--white)}
.btn.buy {
    background: #000 !important;   /* fundo preto */
    color: #fff !important;         /* texto branco */
}



.carousel {
  position: relative;
  width: 100%;
  height: 320px;
  overflow: hidden;
  border-radius: 8px;
  background: #0a0a0a;
  display: flex;
  align-items: center;
  justify-content: center;
}

.carousel-track {
  display: flex;
  transition: transform 0.4s ease-in-out;
  width: 100%;
  height: 100%;
}



/* arrow shared style (round, like banner) */
.arrow-btn {
  position: absolute;
  top: 50%;
  transform: translateY(-50%);
  background: rgba(15,15,15,0.6);
  color: #fff;
  border: none;
  font-size: 24px;
  cursor: pointer;
  z-index: 2;
  border-radius: 50%;
  width: 44px;
  height: 44px;
  display:flex;
  align-items:center;
  justify-content:center;
  transition: background 0.2s, transform .12s;
}
.arrow-btn:hover{ background: rgba(255,255,255,0.1); transform: translateY(-50%) scale(1.03); }
.arrow-left{ left: 10px; }
.arrow-right{ right: 10px; }

/* carrinho lateral */
.cart{position:fixed;right:0;top:0;height:100vh;width:360px;background:#0b0b0b;padding:18px;transform:translateX(100%);transition:transform .28s ease;box-shadow:-8px 0 30px rgba(0,0,0,0.6);z-index:80}
.cart.open{transform:translateX(0)}
.cart h3{margin:0 0 12px}
.cart .item{display:flex;gap:12px;align-items:center;padding:10px 0;border-bottom:1px solid rgba(255,255,255,0.03)}
.cart .item img{width:56px;height:56px;object-fit:cover;border-radius:8px}
.cart .total{display:flex;justify-content:space-between;margin-top:14px;font-weight:700;color:var(--accent)}

/* floating cart button (estilo WhatsApp) */
.cart-float {
  position: fixed;
  bottom: 110px; /* above whatsapp button */
  right: 22px;
  width: 55px;
  height: 55px;
  background: var(--accent);
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  box-shadow: 0 8px 25px rgba(0,0,0,0.35);
  z-index: 9998;
  cursor: pointer;
  transition: transform .18s ease, box-shadow .18s ease;
  animation: pulseCart 1.9s infinite ease-in-out;
}
.cart-float:focus { outline: 3px solid rgba(255,204,0,0.18); transform: translateY(-3px); }
.cart-float:hover { transform: translateY(-4px); box-shadow: 0 14px 40px rgba(0,0,0,0.45); }

@keyframes pulseCart {
  0% { transform: scale(1); }
  50% { transform: scale(1.06); }
  100% { transform: scale(1); }
}
.cart-float svg { width:24px; height:24px; }

.cart-badge {
  position: absolute;
  top: 6px;
  right: 6px;
  min-width:16px;
  height:16px;
  border-radius:999px;
  background:#000;
  color:var(--accent);
  font-weight:700;
  font-size:10px;
  display:flex;
  align-items:center;
  justify-content:center;
  padding:0 6px;
  box-shadow:0 2px 6px rgba(0,0,0,0.5);
}

/* whatsapp float (kept as before) */
.whatsapp-float {
  position: fixed;
  bottom: 22px;
  right: 22px;
  width: 55px;
  height: 55px;
  background: #25d366;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  box-shadow: 0 8px 25px rgba(0,0,0,0.35);
  z-index: 9999;
  animation: pulse 1.8s infinite ease-in-out;
  transition: .3s;
}
.whatsapp-float:hover { transform: scale(1.12); box-shadow: 0 0 22px rgba(0, 255, 0, 0.65); }
@keyframes pulse { 0% { transform: scale(1); } 50% { transform: scale(1.08); } 100% { transform: scale(1); } }

footer{padding:28px 18px;color:var(--muted);text-align:center}

.whatsapp-float svg {
  width: 22px !important;
  height: 22px !important;
}


/* banners (kept) */
.banner-carousel {
  position: relative;
  width: 100%;
  height: 300px;
  overflow: hidden;
  margin-top: 10px;
  border-radius: 12px;
  background: #0a0a0a;
  box-shadow: 0 6px 18px rgba(0,0,0,0.6);
}

.banner-track {
  display: flex;
  transition: transform 0.6s ease-in-out;
  width: 100%;
  height: 100%;
}

.banner-track img {
  min-width: 100%;
  height: 300px;
  object-fit: cover;
  border-radius: 12px;
}

.banner-carousel .arrow-btn { width:48px; height:48px; }

.products-grid {
  display: flex;
  flex-direction: column;
  gap: 0;
}

@media (max-width: 1100px) {
  .products-grid {
    grid-template-columns: repeat(3, 1fr);
  }
}

@media (max-width: 800px) {
  .products-grid {
    grid-template-columns: repeat(2, 1fr);
  }
}

@media (max-width: 450px) {
  .products-grid {
    grid-template-columns: repeat(1, 1fr);
  }
}

.product-card {
  min-width: 220px;
  flex-shrink: 0;
}



/* product arrow buttons (made round like banner) */
#prevProducts, #nextProducts {
  position: absolute;
  top: 50%;
  transform: translateY(-50%);
  background: rgba(15,15,15,0.6);
  color: #faf8f8;
  border: none;
  cursor: pointer;
  z-index: 2;
  border-radius: 50%;
  width: 44px;
  height: 44px;
  display:flex;align-items:center;justify-content:center;
}
#prevProducts { left: 8px; }
#nextProducts { right: 8px; }

/* checkout modal and placa/luminoso modals */
.checkout-modal { position: fixed; inset: 0; background: rgba(0,0,0,0.55); display: flex; justify-content: center; align-items: center; z-index: 9999; }
.checkout-box { background: #121212; padding: 25px; border-radius: 12px; width: 90%; max-width: 420px; color: white; position: relative; }
.checkout-box input, .checkout-box textarea { width: 100%; padding: 10px; background: #1d1d1d; border: 1px solid #333; border-radius: 8px; color: white; margin-bottom: 12px; }
.close-checkout { position: absolute; right: 10px; top: 10px; background: transparent; border: none; color: white; font-size: 20px; cursor: pointer; }
.btn-confirmar-pedido { width: 100%; padding: 12px; margin-top: 10px; border: none; background: #FDD835; color: #000; font-size: 16px; font-weight: bold; border-radius: 8px; cursor: pointer; }

/* modal placa / luminoso */
.modal-placa-bg { position: fixed; inset: 0; background: rgba(0,0,0,0.65); display: none; justify-content: center; align-items: center; z-index: 999999; }
.modal-placa-box {
    width: 90%;
    max-width: 380px; /* diminu√≠mos o tamanho */
    background: #161616;
    padding: 18px; /* padding menor */
    border-radius: 14px;
    color: #fff;
    animation: placaZoom .25s ease;
    box-shadow: 0 0 20px rgba(0,0,0,0.4);
    max-height: 85vh;         /* impede de ultrapassar tela */
    overflow-y: auto;         /* ativa rolagem se necess√°rio */
}
@keyframes placaZoom { from { transform: scale(0.7); opacity: 0; } to { transform: scale(1); opacity: 1; } }
.modal-placa-box input, .modal-placa-box textarea { width: 100%; margin-bottom: 10px; padding: 10px; border-radius: 8px; border: 1px solid #333; background: #111; color: white; }

/* small responsive tweaks */
@media(max-width:480px){
  .arrow-btn, #prevProducts, #nextProducts { width: 38px; height: 38px; }
  .carousel-track img, .banner-track img { height: 220px; }
}

/* ===== MODAL PADRONIZADO ===== */

.modal {
  position: fixed;
  inset: 0;
  background: rgba(0,0,0,0.6);
  display: none;
  align-items: center;
  justify-content: center;
  padding: 20px;
  z-index: 999;
}

.modal .dialog {
  width: 100%;
  max-width: 460px;       /* TAMANHO FIXO */
  height: auto;
  background: #161616;
  border-radius: 14px;
  padding: 16px;
  display: flex;
  flex-direction: column;
  gap: 14px;
  position: relative;
  box-shadow: 0 0 25px rgba(0,0,0,0.5);
  overflow: visible !important;       /* evita esticar */
}

/* For√ßar o carrossel a ter o MESMO TAMANHO SEMPRE */
.modal .carousel {
  width: 100%;
  height: 35vh; /* ocupa 35% da tela */
  max-height: 260px; /* mas n√£o passa do tamanho original */
  overflow: hidden;
  background: #000;
  position: relative;
}

.carousel-track {
  display: flex;
  width: 100%;
  height: 100%;
  transition: transform .3s ease;
}



/* Bot√µes */
.modal .close {
  position: absolute;
  top: 10px;
  right: 10px;
  background: #00000070;
  border: none;
  color: #fff;
  font-size: 22px;
  width: 32px;
  height: 32px;
  border-radius: 50%;
}

#modalTitle {
  font-size: 18px;
  font-weight: 700;
}

#modalDesc {
  font-size: 14px;
  opacity: 0.8;
  line-height: 1.4;
}

#modalPrice {
  font-size: 18px;
  font-weight: 700;
  color: #000 !important; /* PRETO */
}

#qty {
  width: 75px;
  padding: 7px;
}




/* --- CORRE√á√ÉO DEFINITIVA DO MODAL NO MOBILE --- */


  .carousel-track img {
    height: 100% !important;
    object-fit: cover;
}





  #modalTitle {
    font-size: 18px !important;
  }

  #modalDesc {
    font-size: 13px !important;
  }

  #modalPrice {
    font-size: 16px !important;
  }

  #qty {
    padding: 6px !important;
    width: 65px !important;
  }

  #addToCartModal {
    padding: 10px !important;
    font-size: 14px !important;
  }



#fullTrack {
    pointer-events: none;
}

#fullTrack img {
    pointer-events: auto;
}


/* ===== CARROSSEL POR CATEGORIA ===== */
.categoria-section {
  margin: 35px 0;
}

.categoria-title {
  font-size: 22px;
  font-weight: 700;
  margin-bottom: 12px;
}

.categoria-wrap {
  position: relative;
  width: 100%;
}

.categoria-track {
  display: flex;
  gap: 18px;
  overflow-x: auto;
  scroll-behavior: smooth;
  padding: 8px 0;
  flex-wrap: nowrap;

  /* ESSENCIAL NO MOBILE */
  touch-action: auto;
  -webkit-overflow-scrolling: touch;
}

.categoria-track::-webkit-scrollbar {
  height: 0;
}

.cat-arrow {
  position: absolute;
  top: 50%;
  transform: translateY(-50%);
  background: rgba(15,15,15,0.6);
  color: #fff;
  border: none;
  font-size: 24px;
  cursor: pointer;
  z-index: 10;
  border-radius: 50%;
  width: 44px;
  height: 44px;
  display:flex;
  align-items:center;
  justify-content:center;
}

.cat-arrow.left { left: -5px; }
.cat-arrow.right { right: -5px; }

/* Garantir que o bot√£o VOLTAR apare√ßa no modal */
#btnVoltar {
  display: block !important;
  margin-top: 10px !important;
  z-index: 20 !important;
}

.modal .dialog {
  overflow: visible !important;
}

@media (max-width: 600px) {
  .modal .dialog {
    max-height: 90vh;
    overflow-y: auto !important;
    padding-bottom: 20px; /* espa√ßo para o bot√£o aparecer */
  }
}

.modal .dialog {
  display: flex;
  flex-direction: column;
  height: 92vh; /* altura do modal toda */
}

.modal .dialog .conteudo-modal {
  overflow-y: auto;
  padding-right: 8px;
  flex: 1; /* ocupa o restante do espa√ßo */
}


/* Altura padr√£o no PC */
.banner-carousel,
.banner-track img {
    height: 300px !important;
}

/* Ajuste perfeito no mobile */
@media (max-width: 600px) {
    .banner-carousel,
    .banner-track img {
        height: 160px !important; /* banner menor e sem cortar */
    }
}

/* Ajuste ainda menor para telas muito pequenas */
@media (max-width: 400px) {
    .banner-carousel,
    .banner-track img {
        height: 130px !important;
    }
}

.logo-img {
  width: 55px;
  height: 55px;
  object-fit: cover;
  border-radius: 12px; /* deixe redondo se quiser */
}

/* ============================
   üé® TEMA CLARO COMPLETO
   ============================ */

/* Fundo geral */
body {
    background: #f5f5f5 !important;
    color: #000 !important;
}

/* Header */
header {
    background: #ffffff !important;
    color: #000 !important;
    border-bottom: 1px solid #ddd !important;
}

/* Campos de busca */
.search input {
    background: #ffffff !important;
    color: #000 !important;
    border: 1px solid #ccc !important;
}

/* Cards */
.product-card {
    background: #ffffff !important;
    border: 1px solid #e6e6e6 !important;
    border-radius: 12px !important;
    color: #000 !important;
}

/* Nome do produto */
.product-card .title {
    color: #000 !important;
    font-weight: 600 !important;
}

/* Categoria */
.product-card div[style*="color:var(--muted)"],
.product-card .categoria {
    color: #333 !important;
}

/* Pre√ßo normal */
.product-card .price {
    color: #000 !important;
}

/* Pre√ßo promocional */
.product-card .price div {
    color: #d32f2f !important;
}

/* Bot√µes dentro dos cards */
.btn.info {
    background: #f0f0f0 !important;
    color: #000 !important;
    border: 1px solid #ccc !important;
}

.btn.buy {
    background: #000 !important;
    color: #fff !important;
}

/* Carrossel de categorias */
.categoria-carrossel {
    background: #ffffff !important;
}

/* Setas do carrossel */
.cat-btn {
    background: #ffffff !important;
    border: 1px solid #ccc !important;
    color: #000 !important;
}

/* Dots indicadores */
.cat-dot {
    background: #999 !important;
}

.cat-dot.active {
    background: #000 !important;
}

/* Modal (detalhes do produto) */
.modal .dialog {
    background: #ffffff !important;
    color: #000 !important;
}

.modal .dialog img {
    border: 1px solid #ddd !important;
}

.modal .close {
    color: #000 !important;
}

/* Carrinho */
.cart {
    background: #ffffff !important;
    color: #000 !important;
    border-left: 1px solid #ddd !important;
}

.cart .total {
    color: #000 !important;
}

/* Bot√£o flutuante do carrinho */
.cart-float {
    background: #d0cccc !important;
}

.cart-badge {
    background: #000 !important;
    color: #fff !important;
}

/* Footer */
footer {
    color: #000 !important;
    background: #f7f7f7 !important;
}

/* ====== ESTILO NUVEMSHOP ====== */
.filters select,
.filters button {
  padding: 11px 16px;
  border-radius: 12px;
  background: #fff;
  border: 1px solid #ddd;
  color: #000;
  font-weight: 600;
  box-shadow: 0 3px 10px rgba(0,0,0,0.08);
  cursor: pointer;
  transition: .2s ease;
}

.filters select:hover,
.filters button:hover {
  border-color: #222;
  box-shadow: 0 4px 14px rgba(0,0,0,0.12);
}

/* Bot√£o LIMPAR */
#clearFilters {
  background: #f04a4a;
  border: none;
  color: #fff;
}

#clearFilters:hover {
  background: #d23b3b;
}

.filters {
  display: flex;
  gap: 12px;
  flex-wrap: wrap;
  margin-top: 20px !important;  /* AQUI ‚Äî descola dos banners */
}

/* ===== DESKTOP ===== */
.topo {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 15px;
}

.logo-topo {
    width: 90px;
    border-radius: 20px; /* arredondamento */
}

.linha-baixo {
    display: flex;
    align-items: center;
    gap: 15px;
}

.campo-pesquisa {
    padding: 8px;
    font-size: 15px;
    border-radius: 20px; /* borda arredondada */
    border: 1px solid #ccc;
}




/* ---- Estilo padr√£o (PC) ---- */
.sub-frase {
    display: none; /* some no PC */
}


/* ---- MOBILE ---- */
@media (max-width: 600px) {

    .sub-frase {
        display: block;
        font-size: 14px;
        color: #333;
        margin-top: -5px;
        padding-left: 5px;
        text-align: left;
        font-weight: 500;
    }

    .linha-baixo {
        display: grid;
        grid-template-columns: 1fr 1fr;
        grid-template-rows: auto auto;
        width: 100%;
        gap: 2px;
    }

    /* Nome da loja fica no canto esquerdo */
    .nome-loja {
        grid-column: 1;
        grid-row: 1;
        font-size: 18px;
        font-weight: bold;
        color: #000;
    }

    /* Frase fica logo abaixo */
    .sub-frase {
        grid-column: 1;
        grid-row: 2;
    }

    /* Barra de pesquisa √† direita */
    .campo-pesquisa {
        grid-column: 2;
        grid-row: 1 / span 2; /* ocupa duas linhas */
        width: 100%;
        padding: 12px;
        border-radius: 25px;
        text-align: left;
    }

    .search input {
    width: 100%;
    padding: 10px 14px;
    border-radius: 12px; /* borda mais arredondada se quiser */
    border: 1px solid rgba(255,255,255,0.06);
    background: #0b0b0b;
    color: var(--white);
    text-align: left; /* texto digitado na esquerda */
}

/* Placeholder alinhado √† esquerda */
.search input::placeholder {
    text-align: left;
    color: #aaaaaa;
}
}


/* Ajuste do bot√£o de menu no mobile */
@media (max-width: 600px) {
  #btnMenu {
    margin-left: -10px !important; /* empurra mais para o canto */
    margin-right: 0 !important;
    position: relative;
    left: -145px; /* ajuste fino opcional */
  }
}

#modalDesc {
  color: #232222 !important;   /* mude a cor aqui */
  font-size: 14px;
  line-height: 1.5;
}

/* ===== AJUSTES DO MODAL ===== */

#modalPrice {
  color: #000 !important;
}

#modalPrice div,
#modalPrice span {
  color: #000 !important;
}

#qty {
  color: #000 !important;
  background: #fff !important;
  border: 1px solid #ccc !important;
}


/* SKELETON LOADER PARA OS PRODUTOS */
.skeleton-card {
  background: #e3e3e3;
  border-radius: 12px;
  padding: 12px;
  display: flex;
  flex-direction: column;
  gap: 10px;
  animation: pulseSkeleton 1.4s infinite ease-in-out;
}

.skeleton-thumb {
  width: 100%;
  height: 160px;
  background: #d2d2d2;
  border-radius: 8px;
}

.skeleton-line {
  height: 14px;
  background: #d2d2d2;
  border-radius: 6px;
}

@keyframes pulseSkeleton {
  0% { opacity: 0.7; }
  50% { opacity: 1; }
  100% { opacity: 0.7; }
}

/* FIX ABSOLUTO PARA iPHONE */
@supports (-webkit-touch-callout: none) {

    /* for√ßa o tamanho REAL dos cards */
    .product-card,
    .categoria-track .product-card {
        min-width: 150px !important;  /* antes estava 170‚Äì220 */
        max-width: 150px !important;
    }

    /* reduz a imagem */
    .product-card .thumb,
    .categoria-track .thumb {
        height: 115px !important;
    }

    /* fonte menor */
    .product-card .title {
        font-size: 13px !important;
    }

    .product-card .price {
        font-size: 14px !important;
    }
}

@supports (-webkit-touch-callout: none) {

    .categoria-track {
        overflow-x: scroll !important;
        -webkit-overflow-scrolling: touch !important;
        scroll-snap-type: x mandatory !important;
    }

    .categoria-track > * {
        scroll-snap-align: start;
    }
}

.tipo-entrega {
  display: flex;
  flex-direction: column;
  gap: 8px;
  margin: 10px 0;
}

.radio-opcao {
  display: flex;
  align-items: center;
  gap: 8px;
  font-size: 15px;
  color: #fff; /* ou #000 se estiver no tema claro */
  cursor: pointer;
}

.radio-opcao input {
  width: 18px;
  height: 18px;
  accent-color: #fdd835; /* cor amarela personalizada */
  cursor: pointer;
}

/* ALINHAR BOT√ÉO CONFIRMAR PEDIDO */
.btn-confirmar-pedido {
    display: block;
    margin: 12px auto 0 auto; /* centraliza horizontalmente */
    width: 100%;              /* ocupa toda a largura da caixa */
    text-align: center;
}

/* ============================
   LOADING OVERLAY (FULLSCREEN)
============================ */
#loadingOverlay {
  position: fixed;
  inset: 0;
  background: #ffffff;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  z-index: 999999999; /* fica na frente de tudo */
  font-family: Poppins, sans-serif;
  color: #000;
  text-align: center;
  padding: 20px;
}

/* Texto pulsando */
.loading-text {
  font-size: 22px;
  font-weight: 700;
  animation: pulseLoading 1.6s infinite ease-in-out;
}

@keyframes pulseLoading {
  0% { opacity: 0.6; transform: scale(1); }
  50% { opacity: 1; transform: scale(1.05); }
  100% { opacity: 0.6; transform: scale(1); }
}

/* ===== CORRE√á√ÉO DAS SETINHAS ===== */
.carousel,
.banner-carousel,
.categoria-wrap {
  overflow: visible !important;
}

.arrow-btn,
.cat-arrow,
#prevImg,
#nextImg,
#prevBanner,
#nextBanner {
  z-index: 9999 !important;
  pointer-events: auto !important;
}

/* ==================================================
   MOBILE ‚Äî LOGO NO TAMANHO REAL (1080x1200)
   ================================================== */
@media (max-width: 600px) {

    header.topo {
        display: flex;
        flex-direction: column;
        align-items: center;
        padding: 0;
        background: #000; /* fundo caso sobre espa√ßo */
    }

    /* LOGO ‚Äî imagem manda no layout */
    .logo-topo {
        width: 100%;
        height: auto;              /* üî• ESSENCIAL */
        max-height: 65vh;          /* controla sem cortar */
        object-fit: contain;       /* üî• N√ÉO corta, N√ÉO divide */
        display: block;
        border-radius: 0;
    }

    /* Conte√∫do vem DEPOIS da imagem */
    .linha-baixo {
        width: 100%;
        padding: 12px 14px 16px;
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: 6px;
        background: #fff;          /* separa da imagem */
        text-align: center;
    }

    .nome-loja {
        font-size: 20px;
        font-weight: 800;
        color: #000;
        margin: 0;
    }

    .sub-frase {
        font-size: 14px;
        color: #444;
        margin: 0;
    }

    .campo-pesquisa {
        width: 100%;
        max-width: 420px;
        padding: 14px;
        border-radius: 30px;
        border: 1px solid #ccc;
        text-align: center;
        font-size: 15px;
    }
}


</style>
</head>
<body>
  <div id="loadingOverlay">
  <div class="loading-text">Carregando produtos, aguarde...</div>
</div>

<header class="topo">
  <button id="btnMenu" style="
    background: none;
    border: none;
    font-size: 28px;
    cursor: pointer;
    margin-right: 10px;
">‚ò∞</button>

    <img src="/public/2.png" class="logo-topo" alt="Logo">

    <div class="linha-baixo">
        <h1 class="nome-loja">Conex√£o Shop</h1>

        <!-- AQUI ENTRA A FRASE -->
        <p class="sub-frase">A Conexao √© unica e o estilo √© Diferente</p>

        <input type="text" id="q" class="campo-pesquisa" placeholder="Pesquisar...">
    </div>
</header>




<main class="container">
<section class="banner-carousel" id="bannerCarousel">
  <button class="arrow-btn arrow-left" id="prevBanner">‚ùÆ</button>
  <div class="banner-track" id="bannerTrack"></div>
  <button class="arrow-btn arrow-right" id="nextBanner">‚ùØ</button>
</section>

  

  <!-- AQUI ‚Äî COLOQUE OS FILTROS -->
<div class="filters">
  <select id="filterCategoria"><option value="">Todas categorias</option></select>
  <select id="sort"><option value="recent">Mais recentes</option>
  <option value="price_asc">Pre√ßo ‚Üë</option>
  <option value="price_desc">Pre√ßo ‚Üì</option></select>
  <button id="clearFilters">Limpar filtros</button>
</div>

<div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:12px">
  <h2 style="margin:0">Produtos</h2>
  <div style="color:var(--muted)">Mostrando <span id="prodCount">0</span> produtos</div>
</div>

<div id="productsGrid" class="products-grid"></div>

</main>

<!-- Modal produto -->
<div class="modal" id="modal">
  <div class="dialog" role="dialog" aria-modal="true" >

    <button class="close" id="closeModal" style="position:absolute;top:14px;right:14px">‚úï</button>
    <div class="carousel" style="width:100%">
      <button class="arrow-btn arrow-left" id="prevImg">‚ùÆ</button>
      <div class="carousel-track" id="carouselTrack"></div>
      <button class="arrow-btn arrow-right" id="nextImg">‚ùØ</button>
    </div>
    <div class="conteudo-modal" style="display:flex;flex-direction:column;gap:12px;padding:6px">

      <h3 id="modalTitle"></h3>

 <!-- ===== SELECTOR DE TAMANHO ‚Äî MODELO PADR√ÉO ===== -->
<!-- üîµ SOMENTE PARA BON√â PERSONALIZADO -->
<div id="infoBone" 
     style="display:none; 
            background:#fff3cd;
            border:1px solid #ffeeba;
            padding:12px;
            border-radius:10px;
            color:#000;
            font-size:14px;
            line-height:1.5;
            margin-top:10px;">

  <strong>Bon√© Personalizados</strong><br>
  Unidade ‚Äî <b>R$ 45,00</b><br>
  Acima de 10 unidades ‚Äî <b>R$ 35,00</b><br><br>

  ‚ö†Ô∏è <b>Aten√ß√£o:</b> Consulte as cores dispon√≠veis no WhatsApp ao finalizar o pedido.

  <div style="margin-top:10px;">
    <!-- Radio 1 -->
    <label style="display:flex; align-items:center; gap:8px; margin-bottom:6px;">
      <input type="radio" name="opcaoBone" value="45" checked>
      Unidade ‚Äî R$ 45,00
    </label>

    <!-- Radio 2 -->
    <label style="display:flex; align-items:center; gap:8px;">
      <input type="radio" name="opcaoBone" value="35">
      Acima de 10 unidades ‚Äî R$ 35,00
    </label>
  </div>
</div>

<!-- üîµ SOMENTE PARA PRODUTOS DA CATEGORIA CAMISA -->
<div id="infoCamisas"
     style="display:none;
            background:#e8f4ff;
            border:1px solid #bcdfff;
            padding:12px;
            border-radius:10px;
            color:#000;
            font-size:14px;
            line-height:1.5;
            margin-top:10px;">

  <strong></strong><br>
  Escolha o material:<br><br>

  <label style="display:flex; align-items:center; gap:8px; margin-bottom:6px;">
    <input type="radio" name="opcaoCamisas" value="85">
    Algod√£o ‚Äî R$ 85,00
  </label>

  <label style="display:flex; align-items:center; gap:8px;">
    <input type="radio" name="opcaoCamisas" value="65">
    Poli√©ster ‚Äî R$ 65,00
  </label>

</div>


   <!-- üîµ SOMENTE PARA PERSONALIZE SUA CAMISA -->
<div id="infoPersCamisa"
     style="display:none;
            background:#fff3cd;
            border:1px solid #ffeeba;
            padding:12px;
            border-radius:10px;
            color:#000;
            font-size:14px;
            line-height:1.5;
            margin-top:10px;">

  <strong>Camisas Personalizadas</strong><br>
  Fazemos sob encomenda a partir de 10 unidades, com pre√ßo especial:<br><br>

  <label style="display:flex; align-items:center; gap:8px; margin-bottom:6px;">
    <input type="radio" name="opcaoPersCamisa" value="75" checked>
    Algod√£o ‚Äî R$ 75,00 (cada)
  </label>

  <label style="display:flex; align-items:center; gap:8px;">
    <input type="radio" name="opcaoPersCamisa" value="55">
    Poli√©ster ‚Äî R$ 55,00 (cada)
  </label>

  <br>
  ‚ö†Ô∏è <b>Aten√ß√£o:</b> Consulte com a vendedora cor e tamanho dispon√≠vel.
</div>
  

<div id="tamanhosBandeira" 
     style="display:none; margin-top:10px; padding:12px; border-radius:10px; background:#f4f4f4; color:#000;">
  <h4 style="margin:0 0 8px 0;">üìè Escolha o tamanho:</h4>

  <label style="display:flex; align-items:center; gap:6px; margin-bottom:6px;">
    <input type="radio" name="opcaoTamanho" value="100x65" data-preco="100">
    100√ó65 ‚Äî R$ 100,00
  </label>

  <label style="display:flex; align-items:center; gap:6px;">
    <input type="radio" name="opcaoTamanho" value="120x80" data-preco="120">
    120√ó80 ‚Äî R$ 120,00
  </label>
</div>


      <!-- SOMENTE PARA CATEGORIA BANDEIRA -->
<div id="artePersonalizadaBox" style="display:none; border:1px solid #ddd;padding:12px;border-radius:10px;background:#f9f9f9;color:#000;">
  <h4 style="margin:0 0 8px 0; font-size:16px;">üé® Arte Personalizada</h4>

  <label style="display:flex;align-items:center;gap:6px;margin-bottom:6px;">
    <input type="radio" name="opcaoArte" value="sem_taxa" checked>
    J√° tenho a arte pronta (sem taxa)
  </label>

  <label style="display:flex;align-items:center;gap:6px;">
    <input type="radio" name="opcaoArte" value="com_taxa">
    Preciso que criem a arte do zero (+ R$ 50,00)
  </label>
</div>

<!-- üîµ SOMENTE PARA LUMINOSO ACR√çLICO -->
<div id="infoLumAcrilico"
     style="display:none;
            background:#fff3cd;
            border:1px solid #ffeeba;
            padding:12px;
            border-radius:10px;
            color:#000;
            font-size:14px;
            line-height:1.5;
            margin-top:10px;">

  <strong>Escolha o tamanho:</strong><br><br>

  <label style="display:flex; align-items:center; gap:8px;">
    <input type="radio" name="opcaoLumAcrilico" value="380" data-tamanho="50x10">
    50√ó10 ‚Äî R$ 380,00
  </label>

  <label style="display:flex; align-items:center; gap:8px; margin-bottom:6px;">
    <input type="radio" name="opcaoLumAcrilico" value="600" data-tamanho="80x12">
    80√ó12 ‚Äî R$ 600,00
  </label>

</div>

<!-- üîµ SELECT PARA BRAS√ÉO GRADE DO CAP√î -->
<div id="infoBrasaCapo"
     style="display:none;
            background:#fff3cd;
            border:1px solid #ffeeba;
            padding:12px;
            border-radius:10px;
            font-size:14px;
            color:#000;
            margin-top:10px;">

  <strong>Escolha o modelo:</strong><br><br>

  <label style="display:flex; align-items:center; gap:8px; margin-bottom:6px;">
    <input type="radio" name="opcaoBrasaCapo" value="180" data-modelo="710 Plus">
    710 Plus ‚Äî R$ 180,00
  </label>

  <label style="display:flex; align-items:center; gap:8px; margin-bottom:6px;">
    <input type="radio" name="opcaoBrasaCapo" value="230" data-modelo="Atego 1111/1315/1313">
    Atego 1111/1315/1313 ‚Äî R$ 230,00
  </label>

  <label style="display:flex; align-items:center; gap:8px;">
    <input type="radio" name="opcaoBrasaCapo" value="200" data-modelo="1318 / 1620">
    1318 / 1620 ‚Äî R$ 200,00
  </label>
</div>



      <p id="modalDesc"></p>
      <div style="margin:8px 0">
        <span style="font-weight:700" id="modalPrice"></span>
      </div>
      <div style="display:flex;flex-direction:column;gap:10px; width:100%;">

    <div style="display:flex;gap:8px;align-items:center">
        <input id="qty" type="number" value="1" min="1">
        <button class="btn buy" id="addToCartModal">Adicionar ao carrinho</button>
    </div>

</div>
      </div>
      <button id="btnVoltar" style="background-color:#333;color:#fff;border:none;padding:10px 20px;border-radius:8px;cursor:pointer;font-weight:bold;margin-top:10px;width:100%;">‚Üê Voltar</button>
    </div>
  </div>
</div>

<!-- Carrinho -->
<aside class="cart" id="cart">
  <button id="btnVoltarCarrinho" style="background-color: #333;color: #fff;border: none;padding: 10px 20px;border-radius: 8px;cursor: pointer;font-weight: bold;width: 100%;margin-bottom: 10px;">‚Üê Voltar</button>
  <h3>Carrinho</h3>
  <div id="cartItems" style="overflow:auto;max-height:65vh;padding-right:6px"></div>
  <div class="total"><div>Total</div><div id="cartTotal">R$ 0,00</div></div>
  <div style="margin-top:12px;display:flex;gap:8px">
    <button id="btnCheckout" style="flex:1;padding:12px;border-radius:8px;border:none;background:var(--accent);color:#000;font-weight:700">Finalizar compra</button>
    <button id="btnClear" style="padding:12px;border-radius:8px;border:1px solid rgba(255,255,255,0.06);background:transparent;color:var(--white)">Limpar</button>
  </div>
</aside>

<!-- BOT√ÉO FLUTUANTE CARRINHO -->
<div class="cart-float" id="cartFloat" role="button" tabindex="0" aria-label="Abrir carrinho">
  <svg viewBox="0 0 24 24" fill="none" aria-hidden="true">
    <path d="M6 7 L6 5a6 6 0 0112 0v2" stroke="#000" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round"/>
    <rect x="3" y="7" width="18" height="13" rx="2" stroke="#000" stroke-width="1.6" fill="transparent"/>
  </svg>
  <div class="cart-badge" id="cartCountFloat">0</div>
</div>

<!-- BOT√ÉO WHATSAPP -->
<a href="https://wa.me/553891289179?text=Ol√°!%20Quero%20fazer%20um%20pedido%20üôÇ" 
   target="_blank" class="whatsapp-float" aria-label="Abrir WhatsApp">
    <svg xmlns="http://www.w3.org/2000/svg" width="38" height="38" viewBox="0 0 24 24" fill="#fff" aria-hidden="true">
      <path d="M20.52 3.48A11.77 11.77 0 0 0 12 0a11.77 11.77 0 0 0-8.52 3.48A11.77 11.77 0 0 0 0 12a11.58 11.58 0 0 0 1.56 5.82L0 24l6.36-1.62A11.92 11.92 0 0 0 12 23.94h.01A11.77 11.77 0 0 0 20.52 3.48ZM12 21.39a9.63 9.63 0 0 1-4.91-1.35l-.35-.21-3.77.96 1-3.67-.23-.38A9.66 9.66 0 0 1 2.61 12 9.38 9.38 0 0 1 12 2.61 9.38 9.38 0 0 1 21.39 12 9.38 9.38 0 0 1 12 21.39Zm5.14-7.24c-.28-.14-1.65-.81-1.9-.9s-.44-.14-.63.14-.72.9-.89 1.08-.33.21-.6.07a7.94 7.94 0 0 1-2.34-1.44 8.73 8.73 0 0 1-1.62-2c-.17-.28 0-.43.13-.57.13-.14.28-.33.42-.5a1.9 1.9 0 0 0 .28-.47.51.51 0 0 0-.02-.49c-.07-.14-.63-1.51-.86-2.07s-.46-.48-.63-.49h-.54a1 1 0 0 0-.71.33 3 3 0 0 0-.94 2.19A5.34 5.34 0 0 0 7 11.23a12.06 12.06 0 0 0 4.19 4.67c1.55.94 2.15 1.09 2.92.92a2.47 2.47 0 0 0 1.62-1.14 2 2 0 0 0 .14-1.14c-.06-.12-.25-.21-.53-.35Z"/>
    </svg>
</a>

<footer>¬© Conex√£o Shop</footer>

<!-- ============================
     CHECKOUT MODAL
============================ -->
<div id="checkoutModal" class="checkout-modal" style="display:none;">
  <div class="checkout-box">
    <button id="closeCheckout" class="close-checkout">‚úñ</button>
    <h2>Finalizar Pedido</h2>
    <div class="checkout-form">
      <label>Nome completo *</label>
      <input id="nomeCliente" type="text" placeholder="Seu nome">
      <label>Telefone *</label>
      <input id="telefoneCliente" type="tel" placeholder="(DDD) 00000-0000">
      <label>Forma de entrega:</label>
      <div class="tipo-entrega">
  <label class="radio-opcao">
    <input type="radio" name="tipoEntrega" value="retirada" checked>
    <span>Retirada Em Loja</span>
  </label>

  <label class="radio-opcao">
    <input type="radio" name="tipoEntrega" value="entrega">
    <span>Envio Por Transportadora</span>
  </label>
</div>
    </div>
    <button id="confirmarCheckout" class="btn-confirmar-pedido">Confirmar Pedido</button>
  </div>
</div>

<!-- ============================
     MODAL PLACA
============================ -->
<div id="modalPlaca" class="modal-placa-bg">
  <div class="modal-placa-box">
    <h2 style="margin-top:0; text-align:center; color:#fdd835;">üìå Monte Sua Placa</h2>
    <p style="font-size:14px; opacity:.9; margin-bottom:12px;">‚û°Ô∏è Preencha as informa√ß√µes abaixo:</p>
    <label>1Ô∏è‚É£ Cor da placa:</label>
    <input id="mp_cor" type="text" placeholder="Ex: Preta, Azul, Cromada">
    <label>2Ô∏è‚É£ Nome na parte de cima (Cidade/Estado):</label>
    <input id="mp_topo" type="text" placeholder="Ex: Fortaleza - CE">
    <label>3Ô∏è‚É£ Bandeira (se quiser):</label>
    <input id="mp_bandeira" type="text" placeholder="Ex: Brasil, Cear√°...">
    <label>4Ô∏è‚É£ QRA (nome/apelido grande no centro):</label>
    <input id="mp_qra" type="text" placeholder="Seu QRA aqui">
    <label>5Ô∏è‚É£ Nome ou frase extra embaixo:</label>
    <input id="mp_extra" type="text" placeholder="Ex: Deus √© fiel">
    <label>6Ô∏è‚É£ Mais informa√ß√µes (desenhos, s√≠mbolos, estilo de letra):</label>
    <textarea id="mp_info" placeholder="Desenhos, s√≠mbolos, personagens, estilo de letra..."></textarea>
    <div style="display:flex;gap:8px;margin-top:12px">
      <button id="cancelPlaca" class="btn info" style="flex:1;background:transparent">Cancelar</button>
      <button id="btnEnviarPlaca" class="btn-confirmar-pedido" style="flex:1">Enviar Placa</button>
    </div>
  </div>
</div>

<!-- ============================
     MODAL LUMINOSO (Faixa Refletiva)
============================ -->
<div id="modalLuminoso" class="modal-placa-bg">
  <div class="modal-placa-box">
    <h2 style="margin-top:0; text-align:center; color:#fdd835;">üìå Monte Seu Luminoso</h2>
    <p style="font-size:14px; opacity:.9; margin-bottom:12px;">‚ùå POR FAVOR, ENVIAR AS INFORMA√á√ïES DIGITADAS‚ÄºÔ∏è<br>‚û° Preencha as informa√ß√µes abaixo:</p>
    <label>1Ô∏è‚É£ Indique o n√∫mero do modelo da faixa:</label>
    <input id="lum_modelo" type="text" placeholder="Ex: Modelo 01, 02...">
    <label>2Ô∏è‚É£ Mais informa√ß√µes (desenhos, s√≠mbolos, personagens, estilo de letra, etc):</label>
    <textarea id="lum_info" placeholder="Desenhos, s√≠mbolos, estilo..."></textarea>
    <label>3Ô∏è‚É£ Algum nome em espec√≠fico:</label>
    <input id="lum_nome" type="text" placeholder="Nome (opcional)">
    <label>4Ô∏è‚É£ QRA (nome/apelido grande no centro):</label>
    <input id="lum_qra" type="text" placeholder="QRA">
    <label>5Ô∏è‚É£ Nome ou frase extra embaixo:</label>
    <input id="lum_extra" type="text" placeholder="Frase extra">
    <label>6Ô∏è‚É£ Mais informa√ß√µes (desenhos, s√≠mbolos, personagens, estilo de letra, etc):</label>
    <textarea id="lum_more" placeholder="Detalhes extras..."></textarea>
    <div style="display:flex;gap:8px;margin-top:12px">
      <button id="cancelLum" class="btn info" style="flex:1;background:transparent">Cancelar</button>
      <button id="btnEnviarLum" class="btn-confirmar-pedido" style="flex:1">Enviar Faixa</button>
    </div>
  </div>
</div>

<!-- ============================
     MODAL FAIXAS PERSONALIZADAS
============================= -->
<div id="modalFaixaPersonalizada" class="modal-placa-bg" style="display:none;">
  <div class="modal-placa-box">

    <h2 style="margin-top:0; text-align:center; color:#fdd835;">üìå Monte Sua Faixa Personalizada</h2>

    <p style="font-size:14px; opacity:.9; margin-bottom:12px;">
      1Ô∏è‚É£ Escolha o modelo da faixa (01 a 09).<br>
      2Ô∏è‚É£ Diga o texto ou logo que deseja colocar.<br>
      3Ô∏è‚É£ Enviamos a arte final personalizada pronta para produ√ß√£o!<br><br>

      ‚ùå <b>CASO DE MEDIDAS DIFERENTES, ENVIAR AS MEDIDAS!</b> ‚ùå<br>
      üìè Tamanho padr√£o: <b>240 √ó 10 cm</b>
    </p>

    <label>Modelo da Faixa (01 a 09):</label>
    <input id="fx_modelo" type="text" placeholder="Ex: 01, 02, 03...">

    <label>Texto / Logo desejado:</label>
    <input id="fx_texto" type="text" placeholder="Ex: Nome, frase, logo...">

    <label>Medidas personalizadas (caso queira):</label>
    <input id="fx_medidas" type="text" placeholder="Ex: 300x12 cm">

    <label>Informa√ß√µes adicionais:</label>
    <textarea id="fx_more" placeholder="Detalhes extras..."></textarea>

    <div style="display:flex;gap:8px;margin-top:12px">
      <button id="cancelFaixa" class="btn info" style="flex:1;background:transparent">Cancelar</button>
      <button id="btnEnviarFaixa" class="btn-confirmar-pedido" style="flex:1">Confirmar Faixa</button>
    </div>

  </div>
</div>


<!-- MODAL FULLSCREEN DE IMAGEM -->
<div id="imgFull" style="
  position:fixed;
  inset:0;
  background:rgba(0,0,0,0.9);
  display:none;
  justify-content:center;
  align-items:center;
  z-index:100000;
">
  
<button id="closeFull" style="
    position:absolute;
    top:20px;
    right:20px;
    font-size:30px;
    color:#fff;
    background:transparent;
    border:none;
    cursor:pointer;
    z-index:999999 !important;
">‚úï</button>


  <div id="fullTrack" style="
    display:flex; width:100%; height:100%;
    transition:transform .3s;">
  </div>
</div>

<!-- ========== MODAL ENTREGA J&T EXPRESS ========== -->
<div id="modalEntrega" class="modal-placa-bg" style="display:none;">
  <div class="modal-placa-box">
    <h2 style="margin-top:0; text-align:center; color:#fdd835;">üì¶ Endere√ßo para Entrega</h2>

    <p style="font-size:14px; opacity:.9; margin-bottom:12px;">
      üìå Por favor nos envie seu endere√ßo para emitirmos o tag de envio pela transportadora J&T Express!<br>
      üö® POR FAVOR, ENVIAR AS INFORMA√á√ïES DIGITADAS!
    </p>

    <label>Endere√ßo + n√∫mero:</label>
    <input id="ent_endereco" type="text" placeholder="Rua, N¬∫...">

    <label>N√∫mero telefone:</label>
    <input id="ent_tel" type="text" placeholder="DDD + n√∫mero">

    <label>CEP:</label>
    <input id="ent_cep" type="text">

    <label>Bairro:</label>
    <input id="ent_bairro" type="text">

    <label>Complemento:</label>
    <input id="ent_complemento" type="text">

    <label>Nome completo:</label>
    <input id="ent_nome" type="text">

    <label>CPF:</label>
    <input id="ent_cpf" type="text">

    <label>Pr√≥ximo a:</label>
    <input id="ent_proximo" type="text">

    <div style="display:flex;gap:8px;margin-top:12px">
      <button id="cancelEntrega" class="btn info" style="flex:1;background:transparent">Cancelar</button>
      <button id="btnEnviarEntrega" class="btn-confirmar-pedido" style="flex:1">Confirmar Endere√ßo</button>
    </div>
  </div>
</div>

<aside id="menuLateral" style="
    position: fixed;
    left: 0;
    top: 0;
    height: 100%;
    width: 260px;
    background: #ffffff;
    box-shadow: 4px 0 15px rgba(0,0,0,0.2);
    transform: translateX(-100%);
    transition: .3s ease;
    z-index: 99999;
    padding: 20px;

/* üî• ESSENCIAL */
    overflow-y: auto;
    -webkit-overflow-scrolling: touch;
">
    <h3 style="margin-top:0;">Categorias</h3>
    <div id="listaCategoriasMenu" style="
    margin-top: 10px;
    overflow-y: auto;
    max-height: calc(100vh - 80px);
">
</div>
</aside>

<div id="menuMask" style="
    position: fixed;
    inset: 0;
    background: rgba(0,0,0,0.45);
    display: none;
    z-index: 99998;
"></div>


<script>
/* ========== CONFIG ========= */
const BACKEND = "https://conxao.vercel.app";
const API_BASE = BACKEND + '/api';

let banners = [];
let produtos = [];
let promocoes = [];
let categorias = [];
let cart = JSON.parse(localStorage.getItem('mp_cart') || '[]');

const money = v => Number(v).toLocaleString('pt-BR',{style:'currency',currency:'BRL'});

function debounce(fn, delay = 300) {
  let timer;
  return (...args) => {
    clearTimeout(timer);
    timer = setTimeout(() => fn.apply(this, args), delay);
  };
}


document.addEventListener('DOMContentLoaded', () => {
  /* UI Refs */
  // Mostrar overlay de carregamento
  const loadingOverlay = document.getElementById("loadingOverlay");
  const grid = document.getElementById('productsGrid');
  const prodCount = document.getElementById('prodCount');
  const q = document.getElementById('q');
  const filterCategoria = document.getElementById('filterCategoria');
  const sortSel = document.getElementById('sort');
  const cartEl = document.getElementById('cart');
  const cartItems = document.getElementById('cartItems');
  const cartTotalEl = document.getElementById('cartTotal');
  const cartCountFloat = document.getElementById('cartCountFloat');
  const modal = document.getElementById('modal');
  const modalTitle = document.getElementById('modalTitle');
  const modalDesc = document.getElementById('modalDesc');
  const modalPrice = document.getElementById('modalPrice');
  const qtyInput = document.getElementById('qty');
  const addToCartModal = document.getElementById('addToCartModal');
  const cartFloat = document.getElementById('cartFloat');

  // abrir modal ENTREGA ao selecionar "entrega"
document.querySelectorAll("input[name='tipoEntrega']").forEach(r => {
  r.addEventListener("change", e => {
    if (e.target.value === "entrega") {
      document.getElementById("modalEntrega").style.display = "flex";
    }
  });
});

// fechar modal
document.getElementById("cancelEntrega").onclick = () => {
  document.getElementById("modalEntrega").style.display = "none";
};

// salvar dados de entrega
document.getElementById("btnEnviarEntrega").onclick = () => {
  const dadosEntrega = {
    endereco: document.getElementById("ent_endereco").value.trim(),
    telefone: document.getElementById("ent_tel").value.trim(),
    cep: document.getElementById("ent_cep").value.trim(),
    bairro: document.getElementById("ent_bairro").value.trim(),
    complemento: document.getElementById("ent_complemento").value.trim(),
    nome: document.getElementById("ent_nome").value.trim(),
    cpf: document.getElementById("ent_cpf").value.trim(),
    proximo: document.getElementById("ent_proximo").value.trim(),
  };

  window.__dados_entrega = dadosEntrega;

  document.getElementById("modalEntrega").style.display = "none";
  alert("Endere√ßo salvo! Agora finalize seu pedido.");
};



  /* Banner controls */
  async function carregarBanners(){
    try{
      const res = await fetch(API_BASE + '/banner1');
      banners = await res.json();
      const track = document.getElementById('bannerTrack');
      if(!banners.length){ track.innerHTML = '<div style="color:#aaa;text-align:center;width:100%">Nenhum banner cadastrado</div>'; return; }
      track.innerHTML = banners.map(b=>{
        const img = b.imagem_base64 ? (b.imagem_base64.startsWith('data:image') ? b.imagem_base64 : `data:image/jpeg;base64,${b.imagem_base64}`) : '/placeholder.png';
        return b.link ? `<a href="${b.link}" target="_blank"><img 
  loading="lazy"
  decoding="async"
  src="${img}" 
  alt="${b.titulo || ''}">` : `<img src="${img}" alt="${b.titulo||''}">`;
      }).join('');
      startBannerCarousel();
    }catch(err){ console.error('Erro ao carregar banners:', err); }
  }
  let currentBanner = 0;
  function startBannerCarousel(){
    const track = document.getElementById('bannerTrack'); if(!banners.length) return;
    const prevBtn = document.getElementById('prevBanner'); const nextBtn = document.getElementById('nextBanner');
    prevBtn.onclick = () => { currentBanner = (currentBanner - 1 + banners.length) % banners.length; track.style.transform = `translateX(-${currentBanner * 100}%)`; };
    nextBtn.onclick = () => { currentBanner = (currentBanner + 1) % banners.length; track.style.transform = `translateX(-${currentBanner * 100}%)`; };
    setInterval(()=>{ currentBanner = (currentBanner + 1) % banners.length; track.style.transform = `translateX(-${currentBanner * 100}%)`; }, 6000);
  }

  function ativarSwipeCategoria(track) {
    let isDown = false;
    let startX;
    let scrollLeft;

    // --- MOBILE TOUCH ---
    track.addEventListener("touchstart", (e) => {
        startX = e.touches[0].pageX;
        scrollLeft = track.scrollLeft;
    });

    track.addEventListener("touchmove", (e) => {
        const x = e.touches[0].pageX;
        const walk = (startX - x) * 1.5; // velocidade
        track.scrollLeft = scrollLeft + walk;
    });

    // --- PC MOUSE DRAG ---
    track.addEventListener("mousedown", (e) => {
        isDown = true;
        startX = e.pageX;
        scrollLeft = track.scrollLeft;
        track.style.cursor = "grabbing";
    });

    track.addEventListener("mouseleave", () => {
        isDown = false;
        track.style.cursor = "grab";
    });

    track.addEventListener("mouseup", () => {
        isDown = false;
        track.style.cursor = "grab";
    });

    track.addEventListener("mousemove", (e) => {
        if (!isDown) return;
        e.preventDefault();
        const x = e.pageX;
        const walk = (startX - x) * 1.3; 
        track.scrollLeft = scrollLeft + walk;
    });

    track.style.cursor = "grab";
}

function mostrarSkeletons() {
  const grid = document.getElementById("productsGrid");

  grid.innerHTML = `
    <div style="width:100%;text-align:center;font-size:18px;margin-bottom:12px;color:#555;">
      üîÑ Organizando os Produtos na Vitrine‚Ä¶
    </div>
  `;

  for (let i = 0; i < 8; i++) {
    grid.innerHTML += `
      <div class="skeleton-card">
        <div class="skeleton-thumb"></div>
        <div class="skeleton-line" style="width: 80%"></div>
        <div class="skeleton-line" style="width: 60%"></div>
        <div class="skeleton-line" style="width: 40%"></div>
      </div>
    `;
  }
}


  /* Fetch produtos/promocoes */
  function renderProdutosSimples(lista) {
  const grid = document.getElementById("productsGrid");

  // mostra s√≥ os primeiros (carrega r√°pido)
  grid.innerHTML = lista.slice(0, 12).map(p => {
    let img = "/placeholder.png";

    if (p.imagem_base64) {
      img = p.imagem_base64.startsWith("data:image")
        ? p.imagem_base64
        : `data:image/jpeg;base64,${p.imagem_base64}`;
    }

    return `
      <article class="product-card">
        <div class="thumb">
          <img 
            loading="lazy"
            decoding="async"
            src="${img}"
            width="220"
            height="160"
          >
        </div>

        <div class="title">${p.nome}</div>
        <div class="price">${money(p.preco)}</div>
      </article>
    `;
  }).join("");
}

  function preencherFiltroCategorias() {
  const select = document.getElementById("filterCategoria");

  // evita duplicar categorias
  select.innerHTML = `<option value="">Todas categorias</option>`;

  const categoriasUnicas = [...new Set(
    produtos.map(p => p.categoria_nome || p.categoria).filter(Boolean)
  )];

  categoriasUnicas.forEach(cat => {
    const opt = document.createElement("option");
    opt.value = cat;
    opt.textContent = cat;
    select.appendChild(opt);
  });
}

  async function fetchProdutos(){
  try {
    const r = await fetch(API_BASE + '/produtos');
    produtos = await r.json();

/* üöÄ 1Ô∏è‚É£ MOSTRA PRODUTOS IMEDIATAMENTE */
renderProdutosSimples(produtos);

/* üöÄ 2Ô∏è‚É£ ESCONDE LOADING AGORA */
loadingOverlay.style.display = "none";

/* ‚öôÔ∏è 3Ô∏è‚É£ ORGANIZA TUDO DEPOIS (SEM TRAVAR) */
setTimeout(() => {
  renderMenuCategorias();
  preencherFiltroCategorias();

  // s√≥ renderiza carrossel se N√ÉO estiver pesquisando
  if (!q.value.trim()) {
    renderProdutos();
  }
}, 50);


    // 3Ô∏è‚É£ PROMO√á√ïES EM SEGUNDO PLANO (SEM BLOQUEAR)
    fetchPromocoes().then(() => {
      renderProdutos(); // atualiza pre√ßos se tiver promo√ß√£o
    });

  } catch (e) {
    console.error('Erro produtos', e);
    grid.innerHTML = '<div style="color:#f33">Erro ao carregar produtos</div>';
    loadingOverlay.style.display = "none";
  }
}

  async function fetchPromocoes(){
  try {
    const r = await fetch(API_BASE + '/promocoes');
    promocoes = await r.json();
  } catch(e) {
    promocoes = [];
    console.error('Erro ao buscar promo√ß√µes', e);
  }
}

  function aplicarPromocao(prod){
    const precoOriginal = Number(prod.preco || 0);
    const promo = promocoes.find(p => p.nome_produto === prod.nome && p.ativo !== false);
    if(!promo) return { preco: precoOriginal, label: null };
    if(promo.data_fim && new Date(promo.data_fim) < new Date()) return { preco: precoOriginal, label: null };
    if(promo.tipo === 'percentual'){ const preco = precoOriginal * (1 - Number(promo.valor)/100); return { preco, label: `${promo.valor}% OFF` }; }
    const preco = precoOriginal - Number(promo.valor);
    return { preco: Math.max(0, preco), label: `R$ ${Number(promo.valor).toFixed(2)} OFF` };
  }

 /* ===============================
      CARROSSEL POR CATEGORIA
=============================== */

function renderCategoriasComCarrossel(lista) {
  const container = document.getElementById("productsGrid");
  container.innerHTML = "";

  const grupos = {};
  lista.forEach(p => {
    const cat = p.categoria_nome || p.categoria || "Outros";
    (grupos[cat] ||= []).push(p);
  });

  const categorias = Object.keys(grupos);
  let index = 0;

  function renderProxima() {
    if (index >= categorias.length) return;

    const cat = categorias[index++];
    const produtosCat = grupos[cat];

    const bloco = document.createElement("section");
    bloco.className = "categoria-section";

    bloco.innerHTML = `
      <h2 class="categoria-title">${cat}</h2>
      <div class="categoria-wrap">
        <button class="cat-arrow left">‚ùÆ</button>
        <div class="categoria-track"></div>
        <button class="cat-arrow right">‚ùØ</button>
      </div>
    `;

    const track = bloco.querySelector(".categoria-track");
    const btnLeft = bloco.querySelector(".cat-arrow.left");
    const btnRight = bloco.querySelector(".cat-arrow.right");

    btnLeft.onclick = () => {
      track.scrollBy({ left: -300, behavior: "smooth" });
    };

    btnRight.onclick = () => {
      track.scrollBy({ left: 300, behavior: "smooth" });
    };

    produtosCat.forEach(p => {
      let img = "/placeholder.png";
      if (p.imagem_base64) {
        img = p.imagem_base64.startsWith("data:image")
          ? p.imagem_base64
          : `data:image/jpeg;base64,${p.imagem_base64}`;
      }

      track.innerHTML += `
        <article class="product-card">
          <div class="thumb">
            <img loading="lazy" decoding="async" src="${img}">
          </div>
          <div class="title">${p.nome}</div>
          <div class="price">${money(p.preco)}</div>
          <div class="actions">
            <button class="btn info" onclick="openProduct(${p.id})">Ver</button>
            <button class="btn buy" onclick="addToCart(${p.id},1)">Comprar</button>
          </div>
        </article>
      `;
    });

    container.appendChild(bloco);

    requestAnimationFrame(renderProxima);
  }

  renderProxima();
}



window.scrollCategoria = function (cat, dir) {
    const id = `cat_${cat.replace(/\s+/g, "_")}`;
    const track = document.getElementById(id);
    track.scrollBy({ left: dir * 300, behavior: "smooth" });
};

// Impedir p√°gina de rolar enquanto arrasta o carrossel
function ativarTravamentoDeScroll(track) {
    let startX = 0;
    let startY = 0;
    let isHorizontal = false;

    track.addEventListener("touchstart", (e) => {
        startX = e.touches[0].clientX;
        startY = e.touches[0].clientY;
        isHorizontal = false;
    }, { passive: true });

    track.addEventListener("touchmove", (e) => {
        const dx = e.touches[0].clientX - startX;
        const dy = e.touches[0].clientY - startY;

        // Detecta se o movimento √© horizontal
        if (!isHorizontal && Math.abs(dx) > Math.abs(dy) && Math.abs(dx) > 10) {
            isHorizontal = true;
        }

        // Se for HORIZONTAL ‚Üí trava scroll vertical e move o carrossel
        if (isHorizontal) {
            e.preventDefault(); 
            track.scrollLeft -= dx;
        }

        // Atualiza ponto atual
        startX = e.touches[0].clientX;
        startY = e.touches[0].clientY;
    }, { passive: false });
}



  function renderProdutos(){
    const term = q.value.trim().toLowerCase();
    let list = produtos.slice();
    if(term) list = list.filter(p => (p.nome + ' ' + (p.categoria_nome||p.categoria||'')).toLowerCase().includes(term));
    const cat = filterCategoria.value; if(cat) list = list.filter(p => (p.categoria_nome||p.categoria) === cat);
    const s = sortSel.value;
    if(s === 'price_asc') list.sort((a,b)=>Number(a.preco)-Number(b.preco));
    if(s === 'price_desc') list.sort((a,b)=>Number(b.preco)-Number(a.preco));
    if(s === 'recent') list.sort((a,b)=>b.id-a.id);
    prodCount.textContent = list.length;
    

    renderCategoriasComCarrossel(list);
    updateCartUI();
  }
  


  function escapeHtml(text){ return String(text||'').replace(/[&<>"']/g, s=>({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;' })[s]); }

  /* Cart functions */
  function saveCart(){ localStorage.setItem('mp_cart', JSON.stringify(cart)); updateCartUI(); }
  function updateCartUI(){
    const count = cart.reduce((s,i)=>s + (i.qt||0), 0);
    cartCountFloat.textContent = count;
    cartItems.innerHTML = cart.length === 0
      ? '<div style="color:var(--muted);padding:12px">Carrinho vazio</div>'
      : cart.map(it => {
          const prod = produtos.find(p=>p.id==it.id) || {};
          let imgCart = '/placeholder.png';

// IMAGEM PERSONALIZADA PARA A TAXA DE ARTE
if (it.id === 999999) {
    return `
        <div class="item">
            <img src="/public/icone-tax.png" alt="Taxa de Arte" style="width:56px;height:56px;object-fit:cover;border-radius:8px;">
            <div style="flex:1">
                <div style="font-weight:600">Taxa de Arte Personalizada</div>
                <div style="color:var(--muted)">${money(it.price)}</div>
            </div>
            <div style="display:flex;flex-direction:column;gap:6px">
                <button style="background:transparent;border:none;color:#f55;cursor:pointer"
                        onclick="decrease(999999)">‚àí</button>
            </div>
        </div>
    `;
}



          if (prod.imagem_base64) imgCart = prod.imagem_base64.startsWith('data:image') ? prod.imagem_base64 : `data:image/jpeg;base64,${prod.imagem_base64}`;
          return `
            <div class="item">
              <img src="${imgCart}" alt="">
              <div style="flex:1">
                <div style="font-weight:600">${escapeHtml(prod.nome||'Produto')}</div>
                <div style="color:var(--muted)">${money(it.price)} x ${it.qt}</div>
              </div>
              <div style="display:flex;flex-direction:column;gap:6px">
                <button style="background:transparent;border:none;color:var(--accent);cursor:pointer" onclick="increase(${it.id})">+</button>
                <button style="background:transparent;border:none;color:#f55;cursor:pointer" onclick="decrease(${it.id})">‚àí</button>
              </div>
            </div>
          `;
        }).join('');
    const totalVal = cart.reduce((s,i)=>s + ((i.price||0) * (i.qt||0)), 0);
    cartTotalEl.textContent = money(totalVal);
  }

  function addToCart(id, qtd=1){
    const prod = produtos.find(p=>p.id==id);
    if(!prod){ alert('Produto n√£o encontrado'); return; }
    const promo = aplicarPromocao(prod);
    const existing = cart.find(i=>i.id==id);
    if(existing) existing.qt += qtd;
    else cart.push({ id: prod.id, qt: qtd, price: Number(promo.preco || prod.preco) });
    saveCart();
    /*openCart(); habilitar so por nescessidade do cliente*/ 
  }
  function increase(id){ const it = cart.find(i=>i.id==id); if(it){ it.qt++; saveCart(); } }
  function decrease(id){ const it = cart.find(i=>i.id==id); if(it){ it.qt--; if(it.qt<=0) cart = cart.filter(x=>x.id!=id); saveCart(); } }
  function clearCart(){ if(confirm('Limpar carrinho?')){ cart = []; saveCart(); } }

  /* product modal */
  let currentIndex = 0;
  function openProduct(id){
    const p = produtos.find(x => x.id == id); if(!p) return;
    const imagens = Array.isArray(p.imagens) && p.imagens.length > 0 ? p.imagens : (p.imagem_base64 ? [p.imagem_base64] : []);
    const track = document.getElementById('carouselTrack');
    if(!imagens.length) track.innerHTML = '<div style="color:#aaa">Sem imagem</div>';
    else track.innerHTML = imagens.map(img => {
      const src = img.startsWith('data:image') ? img : `data:image/jpeg;base64,${img}`;
      return `<img loading="lazy" decoding="async" src="${src}" alt="">`;

    }).join('');

    // ‚ûú Ativar clique para fullscreen
    

document.querySelectorAll("#carouselTrack img").forEach((img, index) => {
  img.style.cursor = "zoom-in";
  img.onclick = () => openFullScreen(imagens, index);
});

    currentIndex = 0;
    track.style.transform = `translateX(0%)`;
    const prevImg = document.getElementById('prevImg');
    const nextImg = document.getElementById('nextImg');
    prevImg.onclick = ()=>{ if(imagens.length){ currentIndex = (currentIndex - 1 + imagens.length) % imagens.length; track.style.transform = `translateX(-${currentIndex * 100}%)`; } };
    nextImg.onclick = ()=>{ if(imagens.length){ currentIndex = (currentIndex + 1) % imagens.length; track.style.transform = `translateX(-${currentIndex * 100}%)`; } };

    modalTitle.textContent = p.nome;
    modalDesc.innerHTML = (p.descricao || '').replace(/\n/g, "<br>");

    

 const categoriaProd = (p.categoria_nome || p.categoria || "").toLowerCase().trim();
const nomeProd = (p.nome || "").toLowerCase().trim();

/* ===============================
   LUMINOSO EM ACR√çLICO ‚Äî EXCLUSIVO
================================ */
const infoLumAcrilico = document.getElementById("infoLumAcrilico");

// üî• SOMENTE ESTE PRODUTO
const isLuminosoAcrilico = nomeProd === "luminoso em acr√≠lico";

if (isLuminosoAcrilico) {

    infoLumAcrilico.style.display = "block";

    const radios = document.querySelectorAll("input[name='opcaoLumAcrilico']");

    // remove eventos antigos (evita bug ao abrir v√°rias vezes)
    radios.forEach(r => {
        const clone = r.cloneNode(true);
        r.replaceWith(clone);
    });

    const novosRadios = document.querySelectorAll("input[name='opcaoLumAcrilico']");

    // padr√£o: primeira op√ß√£o
    if (novosRadios.length > 0) {
        novosRadios[0].checked = true;
        modalPrice.textContent = "R$ " + Number(novosRadios[0].value).toFixed(2);
    }

    // troca pre√ßo ao mudar tamanho
    novosRadios.forEach(r => {
        r.addEventListener("change", e => {
            modalPrice.textContent = "R$ " + Number(e.target.value).toFixed(2);
        });
    });

} else {
    infoLumAcrilico.style.display = "none";
}





// üî• ESTA LINHA PRECISA EXISTIR!
const isCamisasCategoria = categoriaProd.includes("camisas");

const infoBone = document.getElementById("infoBone");

if (nomeProd === "bon√© personalizados" || nomeProd === "bon√© personalizado") {

    infoBone.style.display = "block";

    modalPrice.textContent = "R$ 45,00";

    document.querySelectorAll("input[name='opcaoBone']").forEach(r => {
        r.addEventListener("change", e => {
            const preco = Number(e.target.value);
            modalPrice.textContent = "R$ " + preco.toFixed(2);
        });
    });

} else {
    infoBone.style.display = "none";
}

/* ============================
   REGRAS DOS M√ìDULOS DE CAMISA
=============================== */



const infoCamisas = document.getElementById("infoCamisas");          // 85 / 65
const infoPersCamisa = document.getElementById("infoPersCamisa");    // 75 / 55

// üîµ 1 ‚Äî SE FOR "PERSONALIZE SUA CAMISA" ‚Üí MOSTRA OS DOIS
if (nomeProd === "personalize sua camisa") {

    infoCamisas.style.display = "block";       // mostra 85 / 65
    infoPersCamisa.style.display = "block";    // mostra 75 / 55

    // pre√ßo inicial (do personalizado)
    modalPrice.textContent = "R$ 75,00";

    // listeners do m√≥dulo 75/55
    document.querySelectorAll("input[name='opcaoPersCamisa']").forEach(r => {
        r.addEventListener("change", e => {
            modalPrice.textContent = "R$ " + Number(e.target.value).toFixed(2);
        });
    });

    // listeners do m√≥dulo 85/65
    document.querySelectorAll("input[name='opcaoCamisas']").forEach(r => {
        r.addEventListener("change", e => {
            modalPrice.textContent = "R$ " + Number(e.target.value).toFixed(2);
        });
    });

}
// üîµ 2 ‚Äî SE FOR CATEGORIA CAMISAS (mas N√ÉO personalize)
else if (categoriaProd.includes("camisas")) {

    infoCamisas.style.display = "none";    // mostra s√≥ 85/65
    infoPersCamisa.style.display = "none";  // esconde 75/55

    modalPrice.textContent = "R$ 85,00"; // pre√ßo inicial

    document.querySelectorAll("input[name='opcaoCamisas']").forEach(r => {
        r.addEventListener("change", e => {
            modalPrice.textContent = "R$ " + Number(e.target.value).toFixed(2);
        });
    });

}
// üîµ 3 ‚Äî QUALQUER OUTRO PRODUTO ‚Üí esconder tudo
else {
    infoCamisas.style.display = "none";
    infoPersCamisa.style.display = "none";
}




// üîµ REGRA 1: identificar se √© um produto de bandeira comum
const isBandeiraCategoria = categoriaProd.includes("bandeira");

// üîµ REGRA 2: identificar se √© o produto PERSONALIZE SUA BANDEIRA
const isPersonalize = nomeProd === "personalize sua bandeira";

// üîµ MOSTRAR TAMANHOS EM AMBOS OS CASOS
const tamanhoBox = document.getElementById("tamanhosBandeira");
if (isBandeiraCategoria || isPersonalize) {
    tamanhoBox.style.display = "block";

    document.querySelectorAll("input[name='opcaoTamanho']").forEach(r => r.checked = false);
    const defaultRadio = document.querySelector("input[name='opcaoTamanho'][value='100x65']");
    if (defaultRadio) defaultRadio.checked = true;

    modalPrice.textContent = "R$ 100,00";
} else {
    tamanhoBox.style.display = "none";
}


// üîÑ AGORA ‚Äî QUANDO CLICAR NO TAMANHO ‚Üí ATUALIZA O PRE√áO
document.querySelectorAll("input[name='opcaoTamanho']").forEach(radio => {
    radio.addEventListener("change", e => {
        const precoSelecionado = Number(e.target.dataset.preco);
        modalPrice.textContent = "R$ " + precoSelecionado.toFixed(2);
    });
});

// üîµ MOSTRAR TAXA DE ARTE APENAS PARA PERSONALIZE SUA BANDEIRA
const boxArte = document.getElementById("artePersonalizadaBox");
if (isPersonalize) {
    boxArte.style.display = "block";
} else {
    boxArte.style.display = "none";
} 

/* ===============================
   BRAS√ÉO GRADE DO CAP√î ‚Äî MODELOS
================================ */
const infoBrasaCapo = document.getElementById("infoBrasaCapo");

// Detecta qualquer varia√ß√£o do nome
if (nomeProd.includes("bras√£o") || nomeProd.includes("brasa") || nomeProd.includes("grade do capo")) {

    infoBrasaCapo.style.display = "block";

    const radios = document.querySelectorAll("input[name='opcaoBrasaCapo']");

    // Marca primeira op√ß√£o como padr√£o
    if (radios.length > 0) {
        radios[0].checked = true;
        modalPrice.textContent = "R$ " + Number(radios[0].value).toFixed(2);
    }

    // Atualiza pre√ßo ao trocar
    radios.forEach(r => {
        r.addEventListener("change", e => {
            modalPrice.textContent = "R$ " + Number(e.target.value).toFixed(2);
        });
    });

} else {
    infoBrasaCapo.style.display = "none";
}


    const promo = aplicarPromocao(p);
    if(promo.preco < Number(p.preco || 0)){
      modalPrice.innerHTML = `<small style="text-decoration:line-through;color:var(--muted)">${money(p.preco)}</small>
      <div style="color:#0f0;font-weight:700">${money(promo.preco)} <span style="font-size:12px;color:#0f0">${promo.label}</span></div>`;
    } else modalPrice.textContent = money(p.preco);
    qtyInput.value = 1;
    // Remover eventual taxa antiga antes de adicionar novamente
function removeTaxaArte() {
    cart = cart.filter(item => item.id !== 999999); // id reservado para a taxa
    saveCart();
}

    addToCartModal.onclick = () => {
    const quantidade = Number(qtyInput.value || 1);

    // remover taxa anterior
    cart = cart.filter(x => x.id !== 999999);

    // üîµ ADICIONAR BRAS√ÉO GRADE DO CAP√î
if (nomeProd.includes("bras√£o") || nomeProd.includes("brasa") || nomeProd.includes("grade do capo")) {

    const r = document.querySelector("input[name='opcaoBrasaCapo']:checked");
    const preco = Number(r.value);
    const modelo = r.dataset.modelo;
    const quantidade = Number(qtyInput.value || 1);

    cart.push({
        id: p.id,
        qt: quantidade,
        price: preco,
        modelo
    });

    saveCart();
    closeModal();
    return;
}


    // üîµ SE FOR PERSONALIZE SUA BANDEIRA: verificar taxa
    if (isPersonalize) {
        const opcao = document.querySelector("input[name='opcaoArte']:checked").value;

        if (opcao === "com_taxa") {
            cart.push({
                id: 999999,
                qt: 1,
                price: 50,
                virtual: true,
                nome: "Taxa de Arte Personalizada"
            });
        }
    }

    // ----- BON√â: adicionar com pre√ßo selecionado -----
if (nomeProd === "bon√© personalizados" || nomeProd === "bon√© personalizado") {


    const r = document.querySelector("input[name='opcaoBone']:checked");
    const precoBone = Number(r.value);
    const quantidade = Number(qtyInput.value || 1);

    cart.push({
        id: p.id,
        qt: quantidade,
        price: precoBone
    });

    saveCart();
    closeModal();
    return;
}


// üîµ ADICIONAR LUMINOSO EM ACR√çLICO (EXCLUSIVO)
if (nomeProd === "luminoso em acr√≠lico") {

    const r = document.querySelector("input[name='opcaoLumAcrilico']:checked");
    const preco = Number(r.value);
    const tamanho = r.dataset.tamanho;
    const quantidade = Number(qtyInput.value || 1);

    cart.push({
        id: p.id,
        qt: quantidade,
        price: preco,
        tamanho
    });

    saveCart();
    closeModal();
    return;
}



    // üîµ SE FOR BANDEIRA NORMAL OU PERSONALIZE: adicionar com tamanhos
    if (isBandeiraCategoria || isPersonalize) {
        const r = document.querySelector("input[name='opcaoTamanho']:checked");
        const tamanho = r.value;
        const preco = Number(r.dataset.preco);

        cart.push({
            id: p.id,
            qt: quantidade,
            price: preco,
            tamanho
        });

        saveCart();
        closeModal();
        return;
    }

    // üîµ ADICIONAR CAMISA PERSONALIZADA AO CARRINHO
     if(nomeProd === "personalize sua camisa") {
       const r = document.querySelector("input[name='opcaoPersCamisa']:checked");
        const preco = Number(r.value); const quantidade = Number(qtyInput.value || 1);
        const material = r.parentElement.textContent.trim(); // <-- pega o texto do r√°dio
        
        cart.push({ id: p.id,
          qt: quantidade,
          price: preco,
          material: material // <-- salva no carrinho
           });
        
         saveCart();
          closeModal();
           return; }
           
           
    // üîµ ADICIONAR CAMISA NO CARRINHO COM O PRE√áO ESCOLHIDO
     if ((categoriaProd.includes("camisa")) && nomeProd !== "personalize sua camisa") {

    const r = document.querySelector("input[name='opcaoCamisas']:checked");

    if (!r) {
        // se n√£o houver radios, usa o pre√ßo normal do produto
        addToCart(p.id, quantidade);
        closeModal();
        return;
    }

    const precoCamisa = Number(r.value);
    const material = r.parentElement.textContent.trim();

    cart.push({
        id: p.id,
        qt: quantidade,
        price: precoCamisa,
        material
    });

    saveCart();
    closeModal();
    return;
}



    // üîµ PRODUTO NORMAL
    addToCart(p.id, quantidade);
    closeModal();
};



    modal.style.display = 'flex';
    document.body.style.overflow = 'hidden';
  }
  function closeModal(){ modal.style.display = 'none'; document.body.style.overflow = 'auto'; }

  /* open/close cart */
  function openCart(){ cartEl.classList.add('open'); document.body.style.overflow = 'hidden'; }
  function closeCart(){ cartEl.classList.remove('open'); document.body.style.overflow = 'auto'; }

  

  /* event bindings */
  cartFloat.addEventListener('click', openCart);
  document.getElementById('btnVoltarCarrinho').addEventListener('click', closeCart);
  document.getElementById('btnClear').addEventListener('click', clearCart);
  document.getElementById('closeModal').addEventListener('click', closeModal);
  document.getElementById('btnVoltar').addEventListener('click', closeModal);
  modal.addEventListener('click', (e)=>{ if(e.target === modal) closeModal(); });

  // banner arrow ids
  document.getElementById('prevBanner').addEventListener('click', ()=>{ /* handled in startBannerCarousel */ });
  document.getElementById('nextBanner').addEventListener('click', ()=>{ /* handled in startBannerCarousel */ });

  // checkout modal controls
  document.getElementById('closeCheckout').addEventListener('click', ()=>{ document.getElementById('checkoutModal').style.display = 'none'; });
  // Bot√£o Finalizar compra abre o modal de Checkout
document.getElementById('btnCheckout').addEventListener('click', () => {
    document.getElementById('checkoutModal').style.display = 'flex';
});

  /* ========== PLACA / LUMINOSO flow ========== */
  const modalPlaca = document.getElementById('modalPlaca');
  const modalLuminoso = document.getElementById('modalLuminoso');

  // cancel buttons
  document.getElementById('cancelPlaca').addEventListener('click', ()=>{ modalPlaca.style.display = 'none'; });
  document.getElementById('cancelLum').addEventListener('click', ()=>{ modalLuminoso.style.display = 'none'; });

  // helpers to collect placa/luminoso values
  function coletarPlaca(){
    return {
      cor: document.getElementById('mp_cor').value.trim(),
      topo: document.getElementById('mp_topo').value.trim(),
      bandeira: document.getElementById('mp_bandeira').value.trim(),
      qra: document.getElementById('mp_qra').value.trim(),
      extra: document.getElementById('mp_extra').value.trim(),
      info: document.getElementById('mp_info').value.trim()
    };
  }
  function coletarLum(){
    return {
      modelo: document.getElementById('lum_modelo').value.trim(),
      info: document.getElementById('lum_info').value.trim(),
      nome: document.getElementById('lum_nome').value.trim(),
      qra: document.getElementById('lum_qra').value.trim(),
      extra: document.getElementById('lum_extra').value.trim(),
      more: document.getElementById('lum_more').value.trim()
    };
  }

  function coletarFaixaPersonalizada() {
  return {
    modelo: document.getElementById("fx_modelo").value.trim(),
    texto: document.getElementById("fx_texto").value.trim(),
    medidas: document.getElementById("fx_medidas").value.trim(),
    more: document.getElementById("fx_more").value.trim()
  };
}


  // main send: builds message based on cart + placa/luminoso data (if present) and opens WhatsApp
  function sendOrder({ placaData = null, lumData = null, faixaData = null, cliente }) {
    const valor_total = cart.reduce((s,i)=>s + ((i.price||0) * (i.qt||0)), 0);
    const resumoItens = cart.map(it => {

  // taxa de arte
  if (it.id === 999999) {
    return `${it.qt} x Taxa de Arte Bandeira Personalizada: R$ ${(it.price).toFixed(2)}`;
  }

  const prod = produtos.find(p=>p.id == it.id);

    // üîµ SE FOR BRAS√ÉO ‚Üí mostra o MODELO
  if (it.modelo) {
    return `${it.qt} x ${prod?.nome || 'Produto'}
Modelo: ${it.modelo}
Valor unit√°rio: R$ ${(it.price).toFixed(2)}`;
  }

   // üîµ (2) LUMINOSO EM ACR√çLICO ‚Äî TAMANHO
  if (it.tamanho && (prod?.nome || "").toLowerCase().includes("luminoso")) {
    return `${it.qt} x ${prod?.nome}
Tamanho: ${it.tamanho}
Valor unit√°rio: R$ ${(it.price).toFixed(2)}`;
  }

  // Se for bandeira (pois ter√° tamanho)
  if (it.tamanho) {
    return `${it.qt} x ${prod?.nome || 'Produto'}
Tamanho: ${it.tamanho}
Valor unit√°rio: R$ ${(it.price).toFixed(2)}`;
  }

// CAMISAS ‚Äì mostrar material escolhido

// CAMISAS OU PRODUTO COM MATERIAL
if (it.material) {
    return `${it.qt} x ${prod?.nome || 'Produto'}
Material: ${it.material}
Valor unit√°rio: R$ ${(it.price).toFixed(2)}`;
}

// PRODUTO NORMAL
return `${it.qt} x ${prod?.nome || 'Produto'} : R$ ${(it.price).toFixed(2)}`;


}).join('\n--------\n');


    let secPlaca = '';
    if(placaData){
      secPlaca = `
Detalhes da Placa Pesonalizada

1Ô∏è‚É£ Cor da placa:
 ${placaData.cor}

2Ô∏è‚É£ Nome na parte de cima (Cidade/Estado):
 ${placaData.topo}

3Ô∏è‚É£ Bandeira (se quiser):
 ${placaData.bandeira}

4Ô∏è‚É£ QRA (nome/apelido grande no centro):
 ${placaData.qra}

5Ô∏è‚É£ Nome ou frase extra embaixo:
 ${placaData.extra}

6Ô∏è‚É£ Mais informa√ß√µes (desenhos, s√≠mbolos, personagens, estilo de letra, etc):
 ${placaData.info}
--------`;
    }

    let secLum = '';
    if(lumData){
      secLum = `
Detalhes Faixa Refletiva (Luminoso)

1Ô∏è‚É£ Indique o n√∫mero do modelo da faixa:
 ${lumData.modelo}

2Ô∏è‚É£ Mais informa√ß√µes (desenhos, s√≠mbolos, personagens, estilo de letra, etc):
 ${lumData.info}

3Ô∏è‚É£ Algum nome em espec√≠fico:
 ${lumData.nome}

4Ô∏è‚É£ QRA (nome/apelido grande no centro):
 ${lumData.qra}

5Ô∏è‚É£ Nome ou frase extra embaixo:
 ${lumData.extra}

6Ô∏è‚É£ Mais informa√ß√µes:
 ${lumData.more}
--------`;
    }

    let secFaixa = "";
if (faixaData) {
  secFaixa = `
üé® FAIXA PERSONALIZADA

1Ô∏è‚É£ Modelo da faixa:
 ${faixaData.modelo}

2Ô∏è‚É£ Texto / Logo desejado:
 ${faixaData.texto}

3Ô∏è‚É£ Medidas:
 ${faixaData.medidas || "Padr√£o 240 √ó 10 cm"}

4Ô∏è‚É£ Informa√ß√µes adicionais:
 ${faixaData.more}

--------`;
}


        // Recupera dados do modal de entrega
    let dadosEntrega = window.__dados_entrega || null;

    let secEntrega = "";
    if (dadosEntrega) {
      secEntrega = `
üì¶ *ENDERE√áO PARA ENTREGA (J&T)*

Endere√ßo: ${dadosEntrega.endereco}
Telefone: ${dadosEntrega.telefone}
CEP: ${dadosEntrega.cep}
Bairro: ${dadosEntrega.bairro}
Complemento: ${dadosEntrega.complemento}
Nome: ${dadosEntrega.nome}
CPF: ${dadosEntrega.cpf}
Pr√≥ximo √†: ${dadosEntrega.proximo}
--------
`;
    }


    const mensagem = `Ol√°, meu nome √© ${cliente.nome}, esse √© o meu pedido realizado atrav√©s da loja Conex√£o Shop
--------
${resumoItens}
--------
Quantidade de itens: ${cart.length}
Total dos itens: ${money(valor_total)}
--------
${secPlaca}
${secLum}
${secFaixa}
${secEntrega}   
Valor da entrega: A DEFINIR
Valor Total: ${money(valor_total)}
--------
Entrega: Conex√£o Shop
Contato: (38) 99128-9179
--------
Pedido feito com Conex√£o Shop`;

    const linkWhats = `https://wa.me/553891289179?text=${encodeURIComponent(mensagem)}`;
    window.open(linkWhats, '_blank');
    // cleanup
    cart = [];
    saveCart();
    document.getElementById('checkoutModal').style.display = 'none';
    modalPlaca.style.display = 'none';
    modalLuminoso.style.display = 'none';
    closeCart();
    alert('Pedido preparado e enviado para o WhatsApp!');
  }

  // Click handlers for modal send buttons
  document.getElementById('btnEnviarPlaca').addEventListener('click', () => {
    // when clicked in the flow where Placa is required:
    const placaData = coletarPlaca();
    // store temporarily in window flow store
    window.__order_pending_placa = placaData;
    modalPlaca.style.display = 'none';
    // if next is luminoso (we flagged earlier), open it, else send
    if(window.__order_pending_next === 'luminoso'){
      modalLuminoso.style.display = 'flex';
    } else {
      const cliente = { nome: document.getElementById('nomeCliente').value.trim() || 'Cliente' };
      sendOrder({ placaData, lumData: null, cliente });
    }
  });

  document.getElementById('btnEnviarLum').addEventListener('click', () => {
    const lumData = coletarLum();
    modalLuminoso.style.display = 'none';
    // if placa data was previously collected in this flow, include it
    const placaData = window.__order_pending_placa || null;
    const cliente = { nome: document.getElementById('nomeCliente').value.trim() || 'Cliente' };
    sendOrder({ placaData, lumData, cliente });
    // clear pending flags
    window.__order_pending_placa = null;
    window.__order_pending_next = null;
  });

  // cancelar faixa
document.getElementById("cancelFaixa").onclick = () => {
  document.getElementById("modalFaixaPersonalizada").style.display = "none";
};

// enviar informa√ß√µes da faixa
document.getElementById("btnEnviarFaixa").onclick = () => {

  const faixaData = coletarFaixaPersonalizada();
  const cliente = { nome: document.getElementById("nomeCliente").value.trim() || "Cliente" };

  sendOrder({
    placaData: null,
    lumData: null,
    faixaData,
    cliente
  });

  document.getElementById("modalFaixaPersonalizada").style.display = "none";
};


  // Confirmar checkout main handler: decides the flow
  document.getElementById('confirmarCheckout').addEventListener('click', () => {
    const nome = document.getElementById('nomeCliente').value.trim();
    const telefone = document.getElementById('telefoneCliente').value.trim();
    if(!nome || !telefone){ alert('Por favor, preencha pelo menos o nome e o telefone.'); return; }

    // detect products: check both "Placa Personalizada" variants and "Placas Personalizadas" to be safe
    const temPlaca = cart.some(i => {
      const prod = produtos.find(p=>p.id==i.id);
      if(!prod) return false;
      const cat = (prod.categoria_nome || prod.categoria || '').trim();
      return ['Placa Personalizada','Placas Personalizadas','Placa Personalizadas'].includes(cat);
    });
    const temLum = cart.some(i => {
  const prod = produtos.find(p => p.id == i.id);
  if (!prod) return false;

  const cat = (prod.categoria_nome || prod.categoria || '').trim().toLowerCase();

  return (
      cat.includes("luminoso") ||
      cat.includes("faixa refletiva") ||
      cat.includes("faixa")
  );
});


    const temFaixaPersonalizada = cart.some(i => {
      const prod = produtos.find(p => p.id == i.id);
      if (!prod) return false;
      const cat = (prod.categoria_nome || prod.categoria || '').trim().toLowerCase();
      return cat.includes("faixas personalizadas");
    });

    // Se tiver faixas personalizadas ‚Üí abrir MODAL IMEDIATAMENTE
if (temFaixaPersonalizada) {
    modalFaixaPersonalizada = document.getElementById("modalFaixaPersonalizada");
    modalFaixaPersonalizada.style.display = "flex";
    return;
}



    // No special items -> send directly

    // 1Ô∏è‚É£ FAIXA PERSONALIZADA ‚Üí sempre abrir primeiro
if (temFaixaPersonalizada) {
    document.getElementById("modalFaixaPersonalizada").style.display = "flex";
    return;
}

// 2Ô∏è‚É£ PLACA + LUMINOSO
if (temPlaca && temLum) {
    window.__order_pending_next = 'luminoso';
    modalPlaca.style.display = 'flex';
    return;
}

// 3Ô∏è‚É£ S√≥ PLACA
if (temPlaca && !temLum) {
    window.__order_pending_next = null;
    modalPlaca.style.display = 'flex';
    return;
}

// 4Ô∏è‚É£ S√≥ LUMINOSO
if (temLum && !temPlaca) {
    window.__order_pending_next = null;
    modalLuminoso.style.display = 'flex';
    return;
}

// 5Ô∏è‚É£ Nada especial ‚Üí mandar direto
if (!temPlaca && !temLum && !temFaixaPersonalizada) {
    const cliente = { nome };
    sendOrder({ placaData: null, lumData: null, cliente });
    return;
}

  });

  // Expose some functions globally
  window.addToCart = addToCart;
  window.openProduct = openProduct;
  window.increase = (id)=>{ increase(id); };
  window.decrease = (id)=>{ decrease(id); };

  // Search / filters bindings
  q.addEventListener('input', debounce(renderProdutos, 300));
  filterCategoria.addEventListener('change', renderProdutos);
  sortSel.addEventListener('change', renderProdutos);
  document.getElementById('clearFilters').addEventListener('click', ()=>{ q.value=''; filterCategoria.value=''; sortSel.value='recent'; renderProdutos(); });


  // === FULLSCREEN IMAGE ===
  let fullIndex = 0;  // ‚Üê ADICIONEI ESTA LINHA AQUI

const imgFull = document.getElementById("imgFull");
const fullTrack = document.getElementById("fullTrack");
const closeFull = document.getElementById("closeFull");

function openFullScreen(imagens, startIndex = 0) {
  fullTrack.innerHTML = imagens.map(img => `
    <img src="${img.startsWith('data:image') ? img : `data:image/jpeg;base64,${img}`}"
         style="min-width:100%; object-fit:contain;">
  `).join('');

  fullIndex = startIndex;
  fullTrack.style.transform = `translateX(-${fullIndex * 100}%)`;

  imgFull.style.display = "flex";
  document.body.style.overflow = "hidden";
}

closeFull.onclick = () => {
  imgFull.style.display = "none";
  document.body.style.overflow = "auto";
  fullIndex = 0; // reset para n√£o travar a navega√ß√£o
};


// Swipe lateral (mobile)
let startX = 0;
fullTrack.addEventListener("touchstart", e => startX = e.touches[0].clientX);
fullTrack.addEventListener("touchend", e => {
  const endX = e.changedTouches[0].clientX;
  if (endX < startX - 50) fullNext();
  if (endX > startX + 50) fullPrev();
});

function fullNext(){
  if(fullIndex < fullTrack.children.length - 1){
    fullIndex++;
    fullTrack.style.transform = `translateX(-${fullIndex * 100}%)`;
  }
}

function fullPrev(){
  if(fullIndex > 0){
    fullIndex--;
    fullTrack.style.transform = `translateX(-${fullIndex * 100}%)`;
  }
}

// ========== MENU LATERAL ==========
const menu = document.getElementById("menuLateral");
const mask = document.getElementById("menuMask");
const btnMenu = document.getElementById("btnMenu");
const listaMenu = document.getElementById("listaCategoriasMenu");

btnMenu.onclick = () => {
    menu.style.transform = "translateX(0)";
    mask.style.display = "block";
};

mask.onclick = () => {
    menu.style.transform = "translateX(-100%)";
    mask.style.display = "none";
};

// Montar categorias no menu lateral
function renderMenuCategorias() {
    const categoriasUnicas = [...new Set(produtos.map(p => p.categoria_nome || p.categoria))];

    listaMenu.innerHTML = categoriasUnicas.map(cat => `
        <div class="item-categoria-menu" 
             onclick="selecionarCategoriaMenu('${cat}')"
             style="padding: 12px; cursor:pointer; font-size:16px; border-bottom:1px solid #eee;">
            ${cat}
        </div>
    `).join("");
}

// Quando clicar no menu lateral ‚Üí filtrar produtos
window.selecionarCategoriaMenu = (cat) => {
    document.getElementById("filterCategoria").value = cat;
    renderProdutos();

    // fechar menu
    menu.style.transform = "translateX(-100%)";
    mask.style.display = "none";
};


  // initial load
  mostrarSkeletons();

setTimeout(() => {
    fetchProdutos();
}, 3); // tempo IDEAL para o skeleton aparecer

  setTimeout(() => {
  carregarBanners();
}, 800);
  updateCartUI();
});
</script>
</body>
</html>